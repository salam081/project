{% extends 'base/base.html' %}
{% load humanize %}
{% block title %}Members with {{ consumable_type.name }} Requests{% endblock %}

{% block content %}
<div class="container-fluid">
    <a href="{% url 'consumable_types_with_requests' %}" class="btn btn-secondary mb-3">Back to List</a>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon bg-primary">
                <i class="bi bi-folder"></i>
            </div>
            <div class="stat-content">
                <p>Total Requested Amount</p>
                <h3>{{ total_requests_amount|default:0|intcomma }}</h3>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon bg-success">
                <i class="bi bi-people"></i>
            </div>
            <div class="stat-content">
                <p>Total Paid Amount</p>
                <h3>{{ total_paid|default:0|intcomma }}</h3>
            </div>
        </div>
        
       
        
        <div class="stat-card">
            <div class="stat-icon bg-danger">
                <i class="bi bi-graph-up"></i>
            </div>
            <div class="stat-content">
                <p>Total Balance</p>
            <h3>{{total_remaining_balance|default:0|intcomma}}</h3>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header">
                    <h4 class="mb-0">
                        <i class="fas fa-list me-2"></i>Members who requested: **{{ consumable_type.name }}**
                    </h4>
                </div>
                <div class="card-body">
                    {% if requests %}
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Request ID</th>
                                        <th>Member Name</th>
                                        <th>Total Price</th>
                                        <th>Balance</th>
                                        <th>Status</th>
                                        <th>Date Requested</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for request_obj in page_obj  %}
                                    <tr>
                                        <td>#{{ request_obj.id }}</td>
                                        <td>{{ request_obj.user.first_name }} {{ request_obj.user.last_name }} {{ request_obj.user.member.ippis }}</td>
                                        <td>₦{{ request_obj.calculate_total_price|floatformat:2 }}</td>
                                        <td>₦{{ request_obj.balance|floatformat:2 }}</td>
                                      <td>
                                        {% comment %} {{ request_obj.status }} {% endcomment %}
                                        <span class="status-badge 
                                            {% if request_obj.status == 'Pending' %}status-pending
                                            {% elif request_obj.status == 'Approved' %}status-active
                                            {% elif request_obj.status == 'FullyPaid' %}status-completed
                                            {% elif request_obj.status == 'Declined' %}status-cancelled
                                            {% else %}bg-secondary{% endif %}">
                                            {{ request_obj.status }}
                                        </span>
                                    </td>
                                        <td>{{ request_obj.date_created|date:"M d, Y" }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-info" role="alert">
                            <i class="fas fa-info-circle me-2"></i>No members have requested this consumable type yet.
                        </div>
                    {% endif %}
                </div>
              <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">

        {# Show link to page 1 if not on first page #}
        {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
            </li>
        {% endif %}

        {# Display pages 1 to 10 only #}
        {% for num in page_obj.paginator.page_range %}
            {% if num <= 10 %}
                <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                </li>
            {% endif %}
        {% endfor %}

        {# Show Next if not on last page and still within the first 10 pages #}
        {% if page_obj.has_next and page_obj.number < 10 %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
            </li>
        {% endif %}
        
    </ul>
</nav>


            </div>
            
        </div>
        
    </div>
    
</div>
{% endblock %}